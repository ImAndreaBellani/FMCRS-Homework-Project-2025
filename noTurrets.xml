<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.6//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_6.dtd'>
<nta>
	<declaration>typedef struct {
    int x;
    int y;
} Cell;

Cell MAIN_POS = {15,4};

int DAMAGE_TO_MT;

urgent chan STMT; //"SHOOT TO MAIN TOWER"

urgent chan LOCK_DAMAGE_TO_MT;
urgent chan UNLOCK_DAMAGE_TO_MT;

//not used yet

typedef struct {
    int speed;
    int health;
    int damage;
} EnemyConfiguration;

EnemyConfiguration SQUARE := {1, 10, 2};
EnemyConfiguration CIRCLE := {3, 20, 4};

 

</declaration>
	<template>
		<name>enemy</name>
		<parameter>int id, int speed, int health, int damage</parameter>
		<declaration>const Cell START_POS := {0,0};

int c1 := 0; 
Cell pos := START_POS;

void next()
    {
        if (pos.x == 0)
            {
                if (pos.y &lt;=3)
                    pos.y = pos.y+1;
                else
                    if (pos.y == 4)
                        pos.x = 1;
            }
        if (pos.x &gt;=1 &amp;&amp; pos.x &lt;= 6)
            {
                pos.x = pos.x +1;
            }
        if (pos.x == 7)
            {
                if (pos.y == 4)
                    {
                        double app = random(3.0);
                        pos.y = pos.y + fint(app) -1 ;
                    }
                else
                    if (pos.y == 5 || pos.y == 6)
                        pos.y = pos.y + 1;
                    else
                        if (pos.y == 3 || pos.y == 2)
                            pos.y = pos.y - 1;
                        else
                            if (pos.y == 7 || pos.y == 1)
                                pos.x = pos.x + 1;
            }
        if (pos.x &gt;= 8 &amp;&amp; pos.x &lt;= 9)
            {
                if (pos.y == 7 || pos.y == 1)
                    pos.x = pos.x + 1;
            }
        if (pos.x == 10)
            {
                if (pos.y == 7)
                    {
                        double app = fint(random(2.0));
                        if (app == 0)
                            pos.y = pos.y - 1;
                        else
                            pos.x = pos.x + 1;
                    }
                else
                    if (pos.y == 6 || pos.y == 5)
                        pos.y = pos.y - 1;
                    else
                        if (pos.y == 1 || pos.y == 4)
                            pos.x = pos.x + 1;
            }
        if (pos.x &gt;= 11 &amp;&amp; pos.x &lt;= 14)
            {
                if (pos.y == 7 || pos.y == 1 || pos.y == 4)
                    pos.x = pos.x + 1;   
            }
        if (pos.x == 15)
            {
                if (pos.y &lt; 4 &amp;&amp; pos.y &gt;= 1)
                    pos.y = pos.y + 1;
                else
                    if (pos.y &gt; 4 &amp;&amp; pos.y &lt;= 7)
                        pos.y = pos.y - 1;
            }
    }</declaration>
		<location id="id0" x="-272" y="-51">
			<name x="-297" y="-93">onTrip</name>
		</location>
		<location id="id1" x="-263" y="59">
			<name x="-297" y="51">reachedMT</name>
		</location>
		<location id="id2" x="-170" y="136">
			<name x="-187" y="136">readyToShoot</name>
		</location>
		<location id="id3" x="-340" y="136">
			<name x="-408" y="136">onLockRelease</name>
		</location>
		<init ref="id0"/>
		<transition id="id4">
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="guard" x="-527" y="-85">c1&lt;speed &amp;&amp; pos!=MAIN_POS</label>
			<label kind="assignment" x="-416" y="-68">c1=c1+1</label>
			<nail x="-340" y="-34"/>
			<nail x="-340" y="-110"/>
		</transition>
		<transition id="id5">
			<source ref="id0"/>
			<target ref="id1"/>
			<label kind="guard" x="-263" y="0">pos==MAIN_POS</label>
		</transition>
		<transition id="id6">
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="guard" x="-212" y="-93">c1&gt;=speed &amp;&amp; pos!=MAIN_POS</label>
			<label kind="assignment" x="-212" y="-76">next(), c1=0</label>
			<nail x="-212" y="-34"/>
			<nail x="-229" y="-85"/>
		</transition>
		<transition id="id7">
			<source ref="id3"/>
			<target ref="id1"/>
			<label kind="synchronisation" x="-433" y="85">UNLOCK_DAMAGE_TO_MT!</label>
		</transition>
		<transition id="id8">
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="-272" y="119">STMT!</label>
		</transition>
		<transition id="id9">
			<source ref="id1"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-245" y="80">LOCK_DAMAGE_TO_MT!</label>
			<label kind="assignment" x="-245" y="97">DAMAGE_TO_MT = damage</label>
		</transition>
	</template>
	<template>
		<name>STMTCONTROLLER</name>
		<location id="id10" x="-221" y="-68">
			<name x="-231" y="-102">unlock</name>
		</location>
		<location id="id11" x="17" y="-59">
			<name x="7" y="-93">lock</name>
		</location>
		<init ref="id10"/>
		<transition id="id12">
			<source ref="id11"/>
			<target ref="id10"/>
			<label kind="synchronisation" x="-187" y="8">UNLOCK_DAMAGE_TO_MT?</label>
			<nail x="-102" y="8"/>
		</transition>
		<transition id="id13">
			<source ref="id10"/>
			<target ref="id11"/>
			<label kind="synchronisation" x="-170" y="-85">LOCK_DAMAGE_TO_MT?</label>
		</transition>
	</template>
	<template>
		<name x="5" y="5">main</name>
		<parameter>int life</parameter>
		<declaration>void decDamage()
    {
        life = life - DAMAGE_TO_MT;   
    }</declaration>
		<location id="id14" x="-1113" y="-578">
			<name x="-1123" y="-612">alive</name>
		</location>
		<location id="id15" x="-867" y="-578">
			<name x="-877" y="-612">dead</name>
		</location>
		<init ref="id14"/>
		<transition id="id16">
			<source ref="id14"/>
			<target ref="id14"/>
			<label kind="guard" x="-1265" y="-611">life&gt;0</label>
			<label kind="synchronisation" x="-1257" y="-594">STMT?</label>
			<label kind="assignment" x="-1282" y="-577">decDamage()</label>
			<nail x="-1164" y="-527"/>
			<nail x="-1173" y="-544"/>
			<nail x="-1173" y="-612"/>
		</transition>
		<transition id="id17">
			<source ref="id15"/>
			<target ref="id15"/>
			<label kind="synchronisation" x="-807" y="-578">STMT?</label>
			<nail x="-807" y="-595"/>
			<nail x="-816" y="-544"/>
			<nail x="-841" y="-544"/>
			<nail x="-867" y="-552"/>
		</transition>
		<transition id="id18">
			<source ref="id14"/>
			<target ref="id15"/>
			<label kind="guard" x="-1037" y="-612">life &lt;= 0</label>
		</transition>
	</template>
	<system>en0 = enemy(0, 1,10,2);
en1 = enemy(1, 3,20,4);

mt = main(10);
stmtController = STMTCONTROLLER();

system en0, en1, mt, stmtController;


</system>
	<queries>
		<query>
			<formula/>
			<comment/>
		</query>
	</queries>
</nta>
